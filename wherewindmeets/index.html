<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ‚úÖ META CHARSET (CRITICAL) -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Where Winds Meet Interactive Map - 100% Exploration Collection</title>

  <!-- ‚úÖ PRECONNECT TO CRITICAL DOMAINS (EARLY CONNECTION) -->
  <link rel="preconnect" href="https://ik.imagekit.io" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://tiles.bgonegaming.win" crossorigin>
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://accounts.google.com">
  <link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">

  <!-- ‚úÖ CANONICAL URL -->
  <link rel="canonical" href="https://bgonegaming.win/wherewindmeets/" />

  <!-- ‚úÖ META SEO -->
  <meta name="description" content="Complete interactive map for Where Winds Meet featuring 35+ location types: Teleport Landmarks, Treasure Chests, Oddities, Caves, Universal Harmony, Hidden Paths, Wild Ritual Ghost Fire, Antiques, Cat Play, Injustice, Adventures, Meow Meow Treasure, Wander Tales, Tales and Echoes, Overlapping Moon Shadows, Scarecrows, Precious items, Gourmet Food, Special Strange locations, Toilets, Healing Ilnies, Material Fellowship, Gift of Gab, Books, Guards, Outposts, World Bosses, Material Art, Fishing Spots, Pitch Pot, Miaodao card game, Archer Contest, Graceful Melody, Riddles, and Sumo wrestling locations. Track your progress, mark visited locations, and explore every corner of Jianghua with offline support." />
  
  <meta name="author" content="BangOne Gaming" />
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />

  <!-- ‚úÖ FAVICON -->
  <link rel="icon" href="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/Simbol/faviconV2.ico?updatedAt=1762922428848" type="image/x-icon" />

  <!-- ‚úÖ OG / SOCIAL SHARE -->
  <meta property="og:title" content="Where the Wind Meet Interactive Map - Complete Guide" />
  <meta property="og:description" content="Discover 35+ location types including treasure chests, Cat Play, Meow Meow Treasure, Wander Tales, mini-games, and all collectibles across Jianghua of Where the Wind Meet with this comprehensive interactive map." />
  <meta property="og:image" content="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/IMG-20251120-WA0002.jpg" />
  <meta property="og:url" content="https://bgonegaming.win/wherewindmeets/" />
  <meta property="og:type" content="website" />

  <!-- ‚úÖ TWITTER CARD -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Where the Wind Meet Interactive Map - Complete Guide" />
  <meta name="twitter:description" content="Track 35+ location types: treasure chests, Cat Play, Wander Tales, mini-games, World Bosses, and every collectible in Where the Wind Meet's world." />
  <meta name="twitter:image" content="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/IMG-20251120-WA0002.jpg" />

  <!-- ‚úÖ THEME COLOR -->
  <meta name="theme-color" content="#b8860b" />

  <!-- ‚úÖ PRELOAD CRITICAL RESOURCES -->
  <link rel="preload" href="https://unpkg.com/leaflet/dist/leaflet.css" as="style">
  <link rel="preload" href="https://unpkg.com/leaflet/dist/leaflet.js" as="script">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" as="style">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RNEQ8BY21N"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RNEQ8BY21N');
  </script>

  <!-- ‚úÖ STRUCTURED DATA (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Where the Wind Meet Interactive Map - Complete Guide",
    "url": "https://bgonegaming.win/wherewindmeets/",
    "primaryImageOfPage": {
      "@type": "ImageObject",
      "url": "https://ik.imagekit.io/k3lv5clxs/wherewindmeet/IMG-20251120-WA0002.jpg",
      "width": 1200,
      "height": 630
    },
    "image": [
      "https://ik.imagekit.io/k3lv5clxs/wherewindmeet/IMG-20251120-WA0002.jpg"
    ],
    "thumbnailUrl": "https://ik.imagekit.io/k3lv5clxs/wherewindmeet/IMG-20251120-WA0002.jpg",
    "description": "Interactive map for Where the Wind Meet featuring 35+ location types including Teleport Landmarks, Treasure Chests, Oddities, Caves, Universal Harmony, Hidden Paths, Wild Ritual Ghost Fire, Antiques, Cat Play, Injustice, Adventures, Meow Meow Treasure, Wander Tales, Tales and Echoes, Overlapping Moon Shadows, Scarecrows, Precious items, Gourmet Food, Special Strange locations, Toilets, Healing Ilnies, Material Fellowship, Gift of Gab, Books, Guards, Outposts, World Bosses, Material Art, Fishing Spots, Pitch Pot, Miaodao, Archer Contest, Graceful Melody, Riddles, and Sumo locations across Jianghua and Tiangxing regions."
  }
  </script>

  <!-- Leaflet CSS (Critical - Load First) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">

  <!-- ‚úÖ CRITICAL CSS (INLINE FOR FAST RENDER) -->
  <style>
    /* Critical styles for initial render */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Lato', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      overflow: hidden;
      background: #1a1a1a;
    }

    /* Map Container - CRITICAL FOR LCP */
    #map {
      width: 100%;
      height: 100vh;
      background: #2c2c2c;
      position: relative;
      z-index: 1;
    }

    /* Leaflet essentials */
    .leaflet-container {
      background: #2c2c2c;
      font-family: inherit;
    }

    .leaflet-tile {
      filter: brightness(0.9);
    }

    /* Preload Overlay - Optimized */
    #preloadOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    #preloadOverlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #preloadContainer {
      text-align: center;
      color: #fff;
    }

    #preloadEmotionIcon {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    #preloadMessage {
      font-size: 18px;
      margin-bottom: 20px;
      color: #b8860b;
    }

    #preloadBarContainer {
      width: 300px;
      height: 30px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      overflow: hidden;
      position: relative;
    }

    #preloadBarFill {
      height: 100%;
      background: linear-gradient(90deg, #b8860b, #ffd700);
      width: 0%;
      transition: width 0.3s ease;
    }

    #preloadBarPercent {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 14px;
      font-weight: bold;
      color: #fff;
    }

    /* Filter Panel - Critical visibility */
    .filter-panel {
      position: fixed;
      left: -320px;
      top: 0;
      width: 320px;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      transition: left 0.3s ease;
      overflow-y: auto;
    }

    .filter-panel.open {
      left: 0;
    }

    .filter-toggle {
      position: fixed;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 80px;
      background: rgba(0, 0, 0, 0.9);
      border: 2px solid #b8860b;
      color: #b8860b;
      font-size: 20px;
      cursor: pointer;
      z-index: 999;
      border-radius: 0 10px 10px 0;
      transition: left 0.3s ease;
    }

    .filter-toggle.open {
      left: 320px;
    }

    /* Login Button */
    #topLoginBtn {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 24px;
      background: linear-gradient(135deg, #b8860b, #ffd700);
      color: #000;
      border: none;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 4px 15px rgba(184, 134, 11, 0.4);
      transition: transform 0.2s;
    }

    #topLoginBtn:hover {
      transform: translateX(-50%) scale(1.05);
    }

    /* SEO Content - Hidden */
    #seo-content {
      position: absolute;
      left: -9999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
  </style>

  <!-- ‚úÖ GLOBAL ERROR HANDLER -->
  <script>
    // Global error handler to catch all errors
    window.addEventListener('error', function(e) {
      console.error('Global error caught:', e.message, e.filename, e.lineno, e.colno);
      // Don't show overlay errors to user, just log them
      if (e.message && e.message.includes('Script error')) {
        e.preventDefault();
      }
    });

    // Promise rejection handler
    window.addEventListener('unhandledrejection', function(e) {
      console.error('Unhandled promise rejection:', e.reason);
      e.preventDefault();
    });
  </script>

  <!-- ‚úÖ NON-CRITICAL CSS - LOAD ASYNC -->
  <script>
    const CSS_VERSION = "5.9.8";
    
    // Load non-critical CSS asynchronously with error handling
    const cssFiles = [
      'styles.css',
      'marker-image-handler.css',
      'editing-image-upload.css',
      'knowladgelist.css',
      'mystic-skill-panel.css',
      'innerway.css',
      'patchnote.css',
      'form.css',
      'layer.css',
      'region-management.css',
      'booklist.css',
      'ui.css',
      'login.css',
      'comment.css',
      'profile-container.css',
      'setting.css',
      'donate.css',
      'region.css'
    ];
    
    // Async CSS loading with fallback
    cssFiles.forEach(file => {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = `${file}?v=${CSS_VERSION}`;
      link.media = 'print';
      link.onload = function() { 
        this.media = 'all';
        console.log('‚úÖ CSS loaded:', file);
      };
      link.onerror = function() {
        console.warn('‚ö†Ô∏è CSS failed to load:', file);
      };
      document.head.appendChild(link);
    });
  </script>
  
</head>  
<body> 

<!-- ‚úÖ SEO CONTENT (STATIC, FOR SEARCH ENGINE) -->
<main id="seo-content">

  <h1>Where Winds Meet Interactive Map ‚Äì Complete Exploration Guide</h1>

  <p>
    This interactive map for <strong>Where Winds Meet</strong> helps players fully explore the world of Jianghua
    with detailed locations, activities, collectibles, and hidden content.
    The map is designed for both new and experienced players who want 100% world completion.
  </p>

  <section>
    <h2>Map Categories & Activities</h2>
    <p>
      The map includes all major in-game activities and exploration points such as:
    </p>
    <ul>
      <li>Teleport Landmarks and Fast Travel Points</li>
      <li>Treasure Chests, Precious Items, and Antiques</li>
      <li>Oddities, Special Strange Events, and Hidden Encounters</li>
      <li>Cat Play, Meow Meow Treasure, and Wander Tales</li>
      <li>Tales and Echoes, Universal Harmony, and Overlapping Moon Shadows</li>
      <li>World Bosses, Outposts, Guards, and Camps</li>
      <li>Fishing Spots, Pitch Pot, Miaodao Card Game</li>
      <li>Archer Contest, Riddles, Sumo Wrestling, and Mini-Games</li>
      <li>Inner Ways, Mystic Skills, and Material Art locations</li>
    </ul>
  </section>

  <section>
    <h2>Major Regions Covered</h2>
    <p>
      The interactive map covers major regions including <strong>Kaifeng</strong>, <strong>Qinghe</strong>,
      and <strong>Bujian Mountain</strong>, with both surface and underground layers.
    </p>
  </section>

  <section>
    <h2>Key Locations & Landmarks</h2>
    <p>
      Important locations displayed on the map include:
      Kaifeng City, Moonveil Mountain, Verdant Wilds, Sundara Land,
      Mercyheart Town, Thousand Buddha Village, Jadebrook Mountain,
      Song Dynasty Palace, Ghost Market, Grand Canal, Ever-Normal Granary,
      and many other towns, villages, shrines, forests, and hidden areas.
    </p>
  </section>

  <section>
    <h2>Exploration Features</h2>
    <p>
      Players can filter markers by category, track visited locations offline,
      and navigate the world efficiently using zoom-based region labels and layered maps.
    </p>
  </section>

  <p>
    Official interactive map URL:
    <a href="https://bgonegaming.win/wherewindmeets/">
      https://bgonegaming.win/wherewindmeets/
    </a>
  </p>

</main>

<noscript>
  <p>
    Where Winds Meet Interactive Map requires JavaScript to function.
    Visit the interactive map here:
    <a href="https://bgonegaming.win/wherewindmeets/">
      https://bgonegaming.win/wherewindmeets/
    </a>
  </p>
</noscript>

<!-- ‚úÖ SIMPLIFIED PRELOAD - NO BLOCKING -->
<div id="preloadOverlay">
  <div id="preloadContainer">
    <img id="preloadEmotionIcon" src="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/Simbol/faviconV2.ico?updatedAt=1762922428848" alt="Loading" loading="eager">
    <div id="preloadMessage">Loading Interactive Map...</div>
    <div id="preloadBarContainer">
      <div id="preloadBarFill"></div>
      <div id="preloadBarPercent">0%</div>
    </div>
  </div>
</div>

<!-- Leaderboard Panel -->
<div class="leaderboard-panel" id="leaderboardPanel">
  <div class="leaderboard-header">
    <div class="leaderboard-title-img">
      <img src="assets/ui/leaderboard-title.png" alt="Leaderboard" loading="lazy" onerror="this.style.display='none'">
    </div>
    <h2>Top Contributors</h2>
  </div>
  
  <div class="leaderboard-content" id="leaderboardContent">
    <div class="leaderboard-loading">
      <span>‚è≥ Loading contributors...</span>
    </div>
  </div>
  
  <div class="leaderboard-stats" id="leaderboardStats">
    <div>Total Contributors: <strong id="totalContributors">0</strong></div>
    <div>Total Feedbacks: <strong id="totalFeedbacks">0</strong></div>
  </div>
</div>

<!-- Toggle button for leaderboard -->
<button class="leaderboard-toggle" id="leaderboardToggle" onclick="if(typeof toggleLeaderboard === 'function') toggleLeaderboard()">
  üèÜ
</button>

<!-- Filter Panel -->  
<div class="filter-panel" id="filterPanel">  
  <div class="filter-header">  
    <h2 class="filter-title-img">
      <img src="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/alternate.png?updatedAt=1762941265121" alt="Filter Markers" loading="lazy" />
    </h2>
  </div>  
    
  <div class="filter-content" id="filterContent"></div>  
    
  <div class="filter-actions">  
    <button class="filter-btn filter-btn-all" id="btnSelectAll">Select All</button>  
    <button class="filter-btn filter-btn-none" id="btnSelectNone">Clear All</button>  
  </div>  
    
  <div class="filter-stats" id="filterStats">  
    Showing <strong>0</strong> markers  
  </div>  
</div>  

<button class="filter-toggle" id="filterToggle">‚óÄ</button>

<!-- ‚úÖ MAP CONTAINER - LCP ELEMENT -->
<div id="map">
  <!-- Notification Icon -->
  <div id="notificationIcon"></div>

  <!-- Notification Popup Container -->
  <div id="notificationBox">
    <h3>Notifications</h3>
    <div id="notificationContent">
      <p>No notifications yet.</p>
    </div>
  </div>
</div>

<!-- üîµ TOP-CENTER LOGIN BUTTON -->
<button id="topLoginBtn">Login</button>

<!-- GSI Onload -->
<div id="g_id_onload"
     data-client_id="712617149675-2rufcnh8bdq0oo35812no2cgivm81pqp.apps.googleusercontent.com"
     data-context="signin"
     data-ux_mode="popup"
     data-callback="handleGoogleLogin"
     data-auto_prompt="false">
</div>

<!-- ‚úÖ UNIFIED UNDERGROUND CONTAINER -->
<div class="underground-container" id="undergroundContainer">
  <button id="undergroundToggle" class="underground-toggle" title="Toggle Underground Floors">
    <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/layericon.png" alt="Underground" loading="lazy">
  </button>
  
  <div id="undergroundPanel" class="underground-panel">
    <div class="underground-header">
      <h2>üèîÔ∏è Floor Selection</h2>
    </div>

    <div id="undergroundContent" class="underground-content">
    </div>

    <div id="undergroundStats" class="underground-stats">
      <div>
        <span>Active Floor</span>
        <strong id="activeFloorName">Surface</strong>
      </div>
      <div>
        <span>Markers</span>
        <strong id="visibleFloorMarkers">0</strong>
      </div>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div id="loginModal" style="display: none;">
  <div id="loginContent">
    <button id="closeLogin">&times;</button>
    <div id="loginOverlay">
      <div class="g_id_signin"
           data-type="standard"
           data-size="large"
           data-theme="outline"
           data-text="sign_in_with"
           data-shape="rectangular"
           data-logo_alignment="left">
      </div>
    </div>

    <p id="loginNote" style="margin-top: 20px; font-size: 14px; color: #333; text-align: center;">
      This login is not connected to the game you play. It only provides access to some map features and stores web data. Read our <a href="policy.html" target="_blank" style="color: #02a0c5; text-decoration: underline;">Privacy and Policy</a> for more information.
    </p>
  </div>
</div>

<!-- Comments Modal -->
<div id="commentsModal" class="comments-modal" style="display: none;">
  <div class="comments-modal-overlay" onclick="if(typeof closeCommentsModal === 'function') closeCommentsModal()"></div>
  <div class="comments-modal-content">
    <div class="comments-modal-header">
      <h3 class="comments-modal-title">üí¨ Looking for Comments</h3>
      <button class="comments-modal-close" onclick="if(typeof closeCommentsModal === 'function') closeCommentsModal()">&times;</button>
    </div>
    
    <div class="comments-modal-body" id="commentsModalBody">
      <div class="comments-loading">Loading comments...</div>
    </div>
    
    <div class="comments-modal-footer" id="commentsModalFooter">
    </div>
  </div>
</div>

<!-- Patch Notes Popup -->
<div class="patch-overlay" id="patchOverlay">
  <div class="patch-popup">

    <button class="patch-close" onclick="if(typeof closePatchPopup === 'function') closePatchPopup()">&times;</button>

    <div class="patch-header">
      <img src="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/BangOne.webp"
           alt="Update" class="patch-image" loading="lazy">
      <h2 class="patch-title">Interactive Map Update</h2>
      <p class="patch-subtitle">Enhanced Features, Region Filters & Performance Improvements</p>
    </div>

    <div class="patch-content">
      <h3>What's New in This Version</h3>

      <ul class="patch-list">
        
        <li>
          <strong>Chest Icon Differentiation</strong>
          <div class="patch-feature-icons">
            <div class="patch-icon-item">
              <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/petiharta.webp" class="patch-icon" alt="Common Chest" loading="lazy">
              <span>Common Chest</span>
            </div>
            <div class="patch-icon-item">
              <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/puzzle_chest.png" class="patch-icon" alt="Puzzle Chest" loading="lazy">
              <span>Puzzle Chest</span>
            </div>
          </div>
          <p class="patch-description">
            Treasure Chests now have distinct icons. Common chests use the standard icon, 
            while puzzle chests (hidden from in-game minimap) use a special icon to help 
            you identify collectibles that require exploration.
          </p>
        </li>

        <li>
          <strong>
            <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/region.webp" class="patch-icon" alt="Region" loading="lazy">
            Region Information & Filtering
          </strong>
          <p class="patch-description">
            <strong>Note:</strong><br>
            This feature is still in beta testing. We will improve it slowly based on your feedback.<br>
            Every marker popup now displays its region name, making it easy to identify 
            location areas. A new region filter allows you to display markers from specific 
            regions only, helping you focus on exploration by area.
          </p>
        </li>

        <li>
          <strong>Optimized Image Loading</strong>
          <p class="patch-description">
            Images in marker popups are now hidden by default and will only load when you 
            click "Show Image". This improves performance and reduces data usage, especially 
            on mobile devices.
          </p>
        </li>

      </ul>

      <h3>Previous Improvements</h3>
      <ul class="patch-list">
        <li>
          <strong>
            <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/camp.webp"
                 class="patch-icon" alt="Camp" loading="lazy">
            Camp &
            <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/NPC.webp"
                 class="patch-icon" alt="NPC" loading="lazy">
            NPC Markers
          </strong>
          <p class="patch-description">
            Camp locations and NPC points have been added to the map.
          </p>
        </li>

        <li>
          <strong>Enhanced Marker Descriptions</strong>
          <p class="patch-description">Improved descriptions for:</p>
          <div class="patch-category-icons">
            <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/knoweverything.webp"
                 class="patch-icon" alt="Wandering Tales" title="Wandering Tales" loading="lazy">
            <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/meow.webp"
                 class="patch-icon" alt="Meow Meow Treasure" title="Meow Meow Treasure" loading="lazy">
            <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/adventure.webp"
                 class="patch-icon" alt="Encounter" title="Encounter" loading="lazy">
            <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/book.webp"
                 class="patch-icon" alt="Experience" title="Experience" loading="lazy">
          </div>
        </li>

        <li>
          <strong>
            <img src="https://tiles.bgonegaming.win/wherewindmeet/Simbol/knoweverything.webp"
                 class="patch-icon" alt="Wandering Tales" loading="lazy">
            Wandering Tales Navigation
          </strong>
          <p class="patch-description">
            Improved title translations and added part navigation buttons to easily locate 
            related quest items and navigate between interconnected objectives.
          </p>
        </li>

        <li>
          <strong>Image System Stability</strong>
          <p class="patch-description">
            The marker image system is now fully stable and functional.
          </p>
        </li>

        <li>
          <strong>General Improvements</strong>
          <p class="patch-description">
            Offline visited marker support, improved zoom clarity, better performance 
            with large marker sets, and refined mobile interactions.
          </p>
        </li>
      </ul>
    </div>

    <div class="patch-footer">
      <p><strong>Thank you for your support</strong></p>
      <p>
        Thank you to everyone who has donated and supported this project.
        Your contributions help improve the <strong>Where Winds Meet Interactive Map</strong> 
        for the entire community.
      </p>

      <div class="patch-contact">
        <a href="https://discord.gg/Mt65qFprs" target="_blank" class="patch-link">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
          </svg>
          Discord
        </a>
        <a href="https://www.tiktok.com/@bangonegaming97?_r=1&_t=ZS-91YooxpNS0A" target="_blank" class="patch-link">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74a2.89 2.89 0 0 1 2.31-4.64a2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
          </svg>
          TikTok
        </a>
      </div>
    </div>

    <div class="patch-brand">
      Made with care by <strong>BangOne Gaming</strong>
    </div>

  </div>
</div>

<!-- Sticky AdSense Container -->
<div id="sticky-ad-container">
  
  <div id="ad-close-wrapper">
      <button id="btn-close-ad">Tutup Iklan</button>
  </div>
  
  <div id="ad-click-detector"></div>
  
  <ins class="adsbygoogle"
       data-ad-client="ca-pub-8582564022805467"
       data-ad-slot="7695704952"
       data-ad-format="auto"
       data-full-width-responsive="true">
  </ins>
</div>

<!-- ‚úÖ AD STYLES & SCRIPTS (DEFERRED) -->
<script>
(function() {
    try {
        const style = document.createElement('style');
        style.textContent = `
            #sticky-ad-container {
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                width: 100% !important;
                text-align: center !important;
                z-index: 400 !important;
                background: rgba(255, 255, 255, 0.3) !important;
                padding: 2px 0 !important;
                box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1) !important;
                transition: all 0.3s ease !important;
                min-height: 60px !important;
            }

            #ad-close-wrapper {
                position: absolute !important;
                top: 10px !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                z-index: 999999 !important;
                pointer-events: none !important;
            }

            #btn-close-ad {
                border: 2px solid #333 !important;
                background: rgba(255, 255, 255, 0.3) !important;
                font-size: 16px !important;
                font-weight: bold !important;
                cursor: pointer !important;
                padding: 6px 18px !important;
                border-radius: 6px !important;
                box-shadow: 0 3px 8px rgba(0,0,0,0.3) !important;
                color: #333 !important;
                font-family: Arial, sans-serif !important;
                transition: all 0.2s ease !important;
            }

            #btn-close-ad:hover {
                box-shadow: 0 4px 10px rgba(0,0,0,0.4) !important;
                transform: scale(1.05) !important;
            }

            #ad-click-detector {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                z-index: 999998 !important;
                cursor: pointer !important;
            }

            #sticky-ad-container .adsbygoogle {
                display: block !important;
            }

            @media only screen and (max-width: 480px) {
                #sticky-ad-container {
                    height: 130px !important;
                    max-height: 130px !important;
                    min-height: 130px !important;
                    overflow: hidden !important;
                    padding: 0 !important;
                }
                
                #sticky-ad-container .adsbygoogle {
                    height: 130px !important;
                    max-height: 130px !important;
                    min-height: 130px !important;
                    overflow: hidden !important;
                }
                
                #ad-close-wrapper {
                    top: 6px !important;
                }
                
                #btn-close-ad {
                    font-size: 13px !important;
                    padding: 4px 12px !important;
                }
            }
        `;
        document.head.appendChild(style);
    } catch(e) {
        console.error('Ad style injection failed:', e);
    }
})();

(function() {
    try {
        const adContainer = document.getElementById("sticky-ad-container");
        const adIns = adContainer ? adContainer.querySelector('.adsbygoogle') : null;
        
        if (!adContainer) return;
        
        const isMobileDevice = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isSmallScreen = window.innerWidth <= 480;
        
        if (isMobileDevice || isSmallScreen) {
            adContainer.style.cssText = `
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 130px !important;
                max-height: 130px !important;
                min-height: 130px !important;
                overflow: hidden !important;
                padding: 0 !important;
                z-index: 400 !important;
                background: rgba(255, 255, 255, 0.95) !important;
            `;
            
            if (adIns) {
                adIns.style.cssText = `
                    display: block !important;
                    height: 130px !important;
                    max-height: 130px !important;
                    min-height: 130px !important;
                    overflow: hidden !important;
                `;
            }
            
            const observer = new MutationObserver(function() {
                if (adContainer.style.height !== '130px') {
                    adContainer.style.height = '130px';
                    adContainer.style.maxHeight = '130px';
                }
                if (adIns && adIns.style.height !== '130px') {
                    adIns.style.height = '130px';
                    adIns.style.maxHeight = '130px';
                }
            });
            
            observer.observe(adContainer, {
                attributes: true,
                attributeFilter: ['style'],
                subtree: true
            });
        }
    } catch(e) {
        console.error('Ad mobile optimization failed:', e);
    }
})();
</script>

<script>
try {
    (adsbygoogle = window.adsbygoogle || []).push({});

    const btnClose = document.getElementById("btn-close-ad");
    const closeWrapper = document.getElementById("ad-close-wrapper");
    const adContainer = document.getElementById("sticky-ad-container");
    const clickDetector = document.getElementById("ad-click-detector");

    let closeActive = false;

    function hideAd() {
        if (adContainer) adContainer.style.display = "none";
    }

    function enableClose() {
        if (!closeActive) {
            closeActive = true;
            if (closeWrapper) closeWrapper.style.pointerEvents = "auto";
            if (clickDetector) clickDetector.style.pointerEvents = "none";
            setTimeout(hideAd, 3000);
        }
    }

    if (clickDetector) {
        clickDetector.addEventListener("click", function(e) {
            enableClose();
        });
    }

    if (btnClose) {
        btnClose.addEventListener("click", function(e) {
            e.stopPropagation();
            if (closeActive) {
                hideAd();
            }
        });
    }
} catch(e) {
    console.error('Ad interaction setup failed:', e);
}
</script>

<!-- Google AdSense Auto Ads - DEFERRED -->  
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8582564022805467"  
     crossorigin="anonymous"></script>  
  
<script>  
  try {
    (adsbygoogle = window.adsbygoogle || []).push({  
      google_ad_client: "ca-pub-8582564022805467",  
      enable_page_level_ads: true  
    });
  } catch(e) {
    console.error('AdSense initialization failed:', e);
  }
</script>

<!-- ‚úÖ CRITICAL: LEAFLET FIRST -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>    

<!-- Google Sign-In - DEFERRED -->
<script src="https://accounts.google.com/gsi/client" async defer></script>  

<!-- ‚úÖ OPTIMIZED SCRIPT LOADING WITH ENHANCED ERROR HANDLING -->
<script>
  const v = Date.now();
  const loadedScripts = new Set();
  const failedScripts = new Set();

  // PRIORITY 1: Critical files needed for initial map render
  const criticalFiles = [
    "ikon.js",           // Icons must load before map
    "peta.js"            // Map initialization
  ];

  // PRIORITY 2: Important but can load in parallel
  const importantFiles = [
    "username.js",
    "cookie-consent.js",
    "memuat-data.js",
    "penanda.js",
    "zoom_optimizer.js"
  ];

  // PRIORITY 3: Features that can load last
  const featureFiles = [
    "feedbackmatker.js",
    "descmanager.js",
    "knowladge-series.js",
    "region-management.js",
    "leaderboard.js",
    "editing-image-upload.js",
    "marker-image-handler.js",
    "booklist.js",
    "knowladgelist.js",
    "mystic-skill-panel.js",
    "innerway.js",
    "profile.js",
    "form.js",
    "layer.js",
    "comment.js",
    "patchnote.js",
    "setting.js",
    "donate.js",
    "region.js"
  ];

  // ‚úÖ ENHANCED SCRIPT LOADER WITH RETRY & FALLBACK
  function loadScript(src, async = true, retries = 3) {
    return new Promise((resolve, reject) => {
      if (loadedScripts.has(src)) {
        console.log(`‚è≠Ô∏è Script already loaded: ${src}`);
        resolve();
        return;
      }

      const attemptLoad = (attemptsLeft) => {
        const script = document.createElement('script');
        script.src = `${src}?v=${v}`;
        if (async) script.async = true;
        
        script.onload = () => {
          loadedScripts.add(src);
          console.log(`‚úÖ Script loaded: ${src}`);
          resolve();
        };
        
        script.onerror = (error) => {
          console.error(`‚ùå Failed to load: ${src} (${attemptsLeft} retries left)`);
          script.remove();
          
          if (attemptsLeft > 0) {
            setTimeout(() => attemptLoad(attemptsLeft - 1), 1000);
          } else {
            failedScripts.add(src);
            console.error(`üíÄ Script permanently failed: ${src}`);
            // Don't reject - continue loading other scripts
            resolve();
          }
        };
        
        document.body.appendChild(script);
      };

      attemptLoad(retries);
    });
  }

  // Update loading progress
  function updateProgress(current, total) {
    const overlay = document.getElementById('preloadOverlay');
    const barFill = document.getElementById('preloadBarFill');
    const barPercent = document.getElementById('preloadBarPercent');
    
    if (barFill && barPercent) {
      const percent = Math.round((current / total) * 100);
      barFill.style.width = percent + '%';
      barPercent.textContent = percent + '%';
    }
  }

  // Load critical files sequentially (needed for map)
  async function loadCriticalScripts() {
    console.log('üîµ Loading critical scripts...');
    for (let i = 0; i < criticalFiles.length; i++) {
      await loadScript(criticalFiles[i], false);
      updateProgress(i + 1, criticalFiles.length + importantFiles.length + 2);
    }
    console.log('‚úÖ Critical scripts loaded');
  }

  // Load important files in parallel
  async function loadImportantScripts() {
    console.log('üü° Loading important scripts...');
    const promises = importantFiles.map((file, index) => 
      loadScript(file).then(() => {
        updateProgress(criticalFiles.length + index + 1, criticalFiles.length + importantFiles.length + 2);
      })
    );
    await Promise.all(promises);
    console.log('‚úÖ Important scripts loaded');
  }

  // Load feature files in parallel (no waiting)
  function loadFeatureScripts() {
    console.log('üü¢ Loading feature scripts...');
    featureFiles.forEach(file => loadScript(file));
  }

  // ‚úÖ EXECUTION ORDER WITH ERROR HANDLING
  (async function initializeApp() {
    try {
      // Load critical scripts
      await loadCriticalScripts();
      
      // Map is ready, hide preloader after short delay
      setTimeout(() => {
        const overlay = document.getElementById('preloadOverlay');
        if (overlay) {
          overlay.classList.add('hidden');
          setTimeout(() => overlay.style.display = 'none', 500);
        }
      }, 800);
      
      // Load important scripts
      await loadImportantScripts();
      
      // Load main.js
      console.log('üîµ Loading main.js...');
      await loadScript('main.js');
      updateProgress(criticalFiles.length + importantFiles.length + 1, criticalFiles.length + importantFiles.length + 2);
      console.log('‚úÖ Main.js loaded');
      
      // Load feature scripts (non-blocking)
      loadFeatureScripts();
      
      // Final progress
      updateProgress(criticalFiles.length + importantFiles.length + 2, criticalFiles.length + importantFiles.length + 2);
      
      // Log summary
      console.log('='.repeat(50));
      console.log('‚úÖ Application initialized');
      console.log(`üìä Loaded: ${loadedScripts.size} scripts`);
      if (failedScripts.size > 0) {
        console.warn(`‚ö†Ô∏è Failed: ${failedScripts.size} scripts`, Array.from(failedScripts));
      }
      console.log('='.repeat(50));
      
    } catch (error) {
      console.error('üí• Critical initialization error:', error);
      
      // Show error message to user
      const overlay = document.getElementById('preloadOverlay');
      const message = document.getElementById('preloadMessage');
      if (message) {
        message.textContent = 'Error loading map. Please refresh the page.';
        message.style.color = '#ff4444';
      }
    }
  })();
</script>

<!-- Service Worker - DEFERRED -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener('load', () => {
    const v = Date.now();
    navigator.serviceWorker.register(`/sw.js?v=${v}`)
      .then(() => console.log("‚úÖ SW registered"))
      .catch(err => console.error("‚ùå SW registration failed:", err));
  });
}
</script>

<!-- Eruda Debug Console - DEFERRED & CONDITIONAL -->
<script>
  if (location.hostname === 'localhost' || location.search.includes('debug=1')) {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/eruda';
    script.onload = () => {
      try {
        eruda.init();
        console.log("‚úÖ Eruda initialized");
      } catch(e) {
        console.error("‚ùå Eruda init failed:", e);
      }
    };
    script.onerror = () => console.error("‚ùå Eruda load failed");
    document.body.appendChild(script);
  }
</script>

</body>  
</html>